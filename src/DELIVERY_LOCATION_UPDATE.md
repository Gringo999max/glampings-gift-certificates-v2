# Обновление логики выбора места получения

## Дата: 1 октября 2025

## Выполненные изменения

### 1. Изменено отображение времени доставки
Объединили название способа доставки и время в одну строчку:
- **До**: Две строки - название на одной, время на другой
- **После**: Одна строка - "Название (+цена) — Время"

**Пример**:
```
Самовывоз из офиса — Через 3 часа
Доставка с курьером (+450 ₽) — Сегодня или позже
Доставка до пункта выдачи (+300 ₽) — 1-5 дней
Быстрая доставка с курьером за 2 часа (+900 ₽) — 2 часа
```

### 2. Обновлен текст информации об офисе
Изменили текст с подробной информацией о местоположении офиса:

**До**:
```
Наш офис находится в нескольких минутах ходьбы от метро Полежаевская
```

**После**:
```
Наш офис находится по адресу: г. Москва, Хорошёвское шоссе, д. 25А, корп. 3. 
Ближайшие станции метро — «Полежаевская» или «Хорошёвская». 
Дорога от метро займёт 3–4 минуты.
```

### 3. Разрешен выбор места получения без выбора конверта/упаковки

Теперь пользователь может выбрать место получения (Москва в пределах МКАД) **без обязательного** выбора конкретного конверта или упаковки.

#### Изменения в логике:

**a) Валидация формы (строки 632-639)**
- **До**: Проверяла место получения только если выбран конверт ИЛИ упаковка
- **После**: Проверяет место получения для всех способов доставки кроме электронного

```typescript
// До
if ((deliveryMethod === 'envelope' || deliveryMethod === 'gift-package') && !deliveryLocation) {
  errors.deliveryLocation = 'Выберите место получения'
}

// После
if (deliveryMethod !== 'electronic' && !deliveryLocation) {
  errors.deliveryLocation = 'Выберите место получения'
}
```

**b) Отображение блока выбора места (строка 2190)**
- **До**: Блок показывался только при выборе конверта или упаковки
- **После**: Блок показывается для всех способов доставки кроме электронного

```typescript
// До
{(deliveryMethod === 'envelope' || deliveryMethod === 'gift-package') && (

// После
{deliveryMethod !== 'electronic' && (
```

**c) useEffect для сброса места получения (строки 884-897)**
- **До**: Сбрасывал deliveryLocation, если не выбраны конверт И упаковка
- **После**: Сбрасывает deliveryLocation только при переключении на электронный сертификат

```typescript
// До
useEffect(() => {
  if (!selectedEnvelope && !selectedPackaging) {
    if (deliveryLocation) {
      setDeliveryLocation('')
      // Очистка ошибок
    }
  }
}, [selectedEnvelope, selectedPackaging, deliveryLocation])

// После
useEffect(() => {
  if (deliveryMethod === 'electronic') {
    if (deliveryLocation) {
      setDeliveryLocation('')
      // Очистка ошибок
    }
  }
}, [deliveryMethod, deliveryLocation])
```

### 4. Исправлены проблемы с таймаутами
Все таймауты в useEffect для автоскролла теперь правильно объявляются и очищаются:
- Переменные таймаутов объявлены в начале useEffect
- Все таймауты очищаются в функции cleanup
- Отступ для скролла к конвертам установлен в `-220px`

## Результат

Теперь форма работает следующим образом:

1. **Электронный сертификат** → Блок места получения НЕ показывается
2. **В фирменном конверте** → Блок места получения показывается (можно выбрать без конверта)
3. **В подарочной упаковке** → Блок места получения показывается (можно выбрать без упаковки)

Пользователь может сначала выбрать "Москва в пределах МКАД" и способ получения, а потом уже определиться с конвертом или упаковкой (или не выбирать вообще).

---

## Обновление от 3 октября 2025

### Оптимизация структуры проекта

**Удалены неиспользуемые файлы:**
- Удалены 3 варианта CheckoutModal (Restructured, Variant2, Variant3)
- Удалено ~2700 строк неиспользуемого кода
- Создан архивный файл `CHECKOUT_MODAL_ARCHIVE.md`

**Исправлен автоскролл:**
- Автоскролл больше не срабатывает при изменении количества товаров
- Добавлен `useRef` для отслеживания реального изменения `deliveryMethod`
- Улучшен UX - нет нежелательных прыжков при использовании кнопок +/-

**Дополнительные улучшения:**
- Обновлена документация (USER_GUIDE_CHECKOUT.md, CHECKOUT_IMPROVEMENTS.md, FIX_SUMMARY.md)
- Улучшена производительность проекта (~40% экономии размера)
- Упрощена навигация по файлам проекта